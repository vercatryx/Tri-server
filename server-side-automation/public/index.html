<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangle Square Automation</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Triangle Square automation</h1>
            <div class="header-badges">
                <span id="device-badge" class="badge badge-muted" title="This computer's device ID" style="display: none;">Device: <b id="device-id">‚Äì</b></span>
                <span id="cpu-usage" class="badge badge-muted" title="Process CPU usage">CPU: ‚Äì%</span>
                <span id="browser-count" class="badge badge-muted" title="Parallel browser slots">Browsers: <b id="browser-count-n">‚Äì</b></span>
                <div id="connection-status" class="badge">Connecting...</div>
            </div>
        </header>

        <section class="summary-bar">
            <div class="total-amount">
                Total amount: <strong id="total-amount">$0.00</strong>
                <span class="total-amount-hint" id="total-amount-hint">(selected / visible)</span>
            </div>
        </section>

        <section class="runners-section" id="runners-section" style="display: none;">
            <h3 class="runners-title">Active runs</h3>
            <div id="runners-grid" class="runners-grid">
                <!-- Runner cards injected by client.js -->
            </div>
        </section>

        <section class="controls" id="controls-section">
            <div id="device-unauthorized-banner" class="device-unauthorized-banner" style="display: none;">
                This device is not authorized. Device ID: <strong id="unauthorized-device-id"></strong> ‚Äî add it to the allowed list to use automation.
            </div>
            <button id="btn-run-queue" onclick="runCurrentQueue()" style="background: #10b981;">‚ñ∂ Run current queue</button>
            <button id="btn-load-file" onclick="loadFromFile()">üìÇ Load from File</button>
            <button id="btn-download" onclick="downloadCloudRequests()" style="background: #0ea5e9;">‚¨á Download from Server</button>
            <button id="btn-import-excel" type="button">üì• Import from Excel</button>
            <input type="file" id="excel-file-input" accept=".xlsx,.xls,.csv" style="display: none;">
            <button id="btn-stop" onclick="stopProcess()" 
                style="background: #ef4444; display: none;">‚èπ Stop Process</button>

            <div class="stats">
                <span>Total: <b id="stat-total">0</b></span>
                <span>Pending: <b id="stat-pending">0</b></span>
                <span>Success: <b id="stat-success">0</b></span>
                <span>Failed: <b id="stat-failed">0</b></span>
            </div>
        </section>

        <div class="main-grid">
            <section class="queue-panel">
                <div class="queue-header">
                    <h2>Request Queue</h2>
                    <label class="filter-by-status">
                        Filter by status:
                        <select id="filter-status" aria-label="Filter by status">
                            <option value="">All</option>
                        </select>
                    </label>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="col-select" title="Select all visible / Shift+click or drag for range">
                                    <input type="checkbox" id="select-all" title="Select all visible" aria-label="Select all">
                                    <span class="select-actions"><button type="button" id="select-none" class="link-btn" title="Clear selection">None</button></span>
                                </th>
                                <th>Client</th>
                                <th class="col-orders">Orders</th>
                                <th class="col-amount">Amount</th>
                                <th>Dates</th>
                                <th class="col-equipment">Equipment</th>
                                <th>Status</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody id="queue-body">
                            <!-- Items will be injected here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="log-panel">
                <h2>Live Activity</h2>
                <div id="terminal" class="terminal">
                    <div class="line dimmed">Waiting for logs...</div>
                </div>
            </section>
        </div>
        <!-- Excel import: column mapping modal -->
        <div id="excel-import-modal" class="modal-overlay" style="display: none;" aria-hidden="true">
            <div class="modal-card">
                <h3>Map columns to billing fields</h3>
                <p class="modal-hint">Choose which Excel column contains each field. URL, Date, Amount, Proof URL and Equipment are required (cannot skip). Name is optional. Rows with empty required fields are skipped. Imported rows have no order IDs, so status is not sent back to the server‚Äîbilling still runs in Unite.</p>
                <div class="modal-mapping">
                    <label><span>URL</span> <select id="map-url" aria-label="Column for URL"></select></label>
                    <label><span>Date</span> <select id="map-date" aria-label="Column for Date"></select></label>
                    <label><span>Amount</span> <select id="map-amount" aria-label="Column for Amount"></select></label>
                    <label><span>Proof URL</span> <select id="map-proofURL" aria-label="Column for Proof URL"></select></label>
                    <label><span>Equipment</span> <select id="map-equipment" aria-label="Column for Equipment"></select></label>
                    <label><span>Name <em>(optional)</em></span> <select id="map-name" aria-label="Column for Name (optional)"></select></label>
                </div>
                <div class="modal-preview" id="excel-preview"></div>
                <div class="modal-actions">
                    <button id="excel-save-file" type="button">Save to Billing File</button>
                    <button id="excel-download-json" type="button">Download JSON</button>
                    <button id="excel-cancel" type="button">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <script src="/client.js"></script>
</body>

</html>